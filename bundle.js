(()=>{"use strict";var t={19:function(t,e,s){var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s(477)),n=i(s(465)),h=i(s(196));class r{constructor(t,e){if(this.unknownCards=new a.default,this.playerSeenVoidInSuits=[],this.cardsIPassed=[],t.hasOwnProperty("whoAmI")){const e=t;this.unknownCards=new a.default(e.unknownCards),this.playerSeenVoidInSuits=e.playerSeenVoidInSuits,this.cardsIPassed.length=0,e.cardsIPassed.forEach((t=>{this.cardsIPassed.push(new h.default(t))})),this.gameHand=new n.default(e.gameHand),this.whoAmI=e.whoAmI}else this.gameHand=t,this.whoAmI=e,this.resetHand()}observeSelf(){this.gameHand.registerObserver(this)}setHand(t){this.gameHand=t}choosePassingCards(){performance.now();const t=this.gameHand.getHand(this.whoAmI),e=new Array(286).fill(0),s=new Array(286).fill([]);let i=0;for(let a=0;a<11;++a)for(let h=a+1;h<12;++h)for(let o=h+1;o<13;++o){const d=[t.at(a),t.at(h),t.at(o)];s[i]=d;for(let t=Math.floor(r.LEVEL/572)+1;t>0;--t){const t=new n.default(this.gameHand),s=[new r(t,0),new r(t,1),new r(t,2),new r(t,3)];t.setHands(this.speculateHands(t.getPassingDirection()));for(let e=0;e<4;++e)e===this.whoAmI?t.pass(e,(e+this.gameHand.getPassingDirection())%4,d):t.pass(e,(e+this.gameHand.getPassingDirection())%4,t.getHand(e).pickRandom(3));t.receivePassedCards();for(let e=13;e>0;--e){for(t.resetTrick();t.turnsLeftInTrick();)t.playCard(s[t.getWhoseTurn()].simPlayCard());t.endTrick()}t.endHand(),e[i]+=t.getScore(this.whoAmI)}++i}let a=0;for(i=0;i<286;++i)e[i]<e[a]&&(a=i);performance.now();return this.whoAmI,t.forEach((t=>{t.str()})),s[a],s[a]}speculateHands(t){const e=[new a.default,new a.default,new a.default,new a.default],s=[this.gameHand.getHand(0).length(),this.gameHand.getHand(1).length(),this.gameHand.getHand(2).length(),this.gameHand.getHand(3).length()];s[this.whoAmI]=0;const i=(this.whoAmI+t)%4;function n(t){return s[t]>0}s[i]-=this.cardsIPassed.length;const h=[];for(let t=0;t<4;++t)h.push([!this.playerSeenVoidInSuits[0][t]&&0!==this.whoAmI,!this.playerSeenVoidInSuits[1][t]&&1!==this.whoAmI,!this.playerSeenVoidInSuits[2][t]&&2!==this.whoAmI,!this.playerSeenVoidInSuits[3][t]&&3!==this.whoAmI]);const r=[];return this.unknownCards.forEach((t=>{if(r.length=0,h[t.suit].forEach(((t,e)=>{t&&n(e)&&r.push(e)})),r.length){const i=r[Math.floor(Math.random()*r.length)];e[i].insert(t),--s[i]}else{const i=[!1,!1,!1,!1];for(let t=0;t<4;++t)if(n(t))for(let e=0;e<4;++e)h[e][t]&&(i[e]=!0);const a=[],r=[];if(h[t.suit].forEach(((t,s)=>{t&&e[s].forEach((t=>{i[t.suit]&&(a.push(t),r.push(s))}))})),a.length){const i=Math.floor(Math.random()*a.length),o=[];h[a[i].suit].forEach(((t,e)=>{t&&n(e)&&o.push(e)})),0===o.length&&console.error("ERROR: assertion fail, single swap, no place to put swap card");const d=o[Math.floor(Math.random()*o.length)];e[d].insert(a[i]),e[r[i]].remove(a[i]),e[r[i]].insert(t),--s[d]}else{const r=h[t.suit].indexOf(!0);let o=0;for(let t=0;t<4;++t)if(n(t)){o=t;break}let d=0;for(;d===r||d===this.whoAmI||d===o;)++d;1!==h[t.suit].filter((t=>t)).length&&console.error("ERROR: big assertion was wrong, hands that allow this suit != 1");const l=[];e[d].forEach((t=>{i[t.suit]&&l.push(t)})),0===l.length&&console.error("ERROR: big assertion was wrong, no cards to move from 3rd to 2nd");const c=l[Math.floor(Math.random()*l.length)];e[o].insert(c),e[d].remove(c),--s[o],e[r].forEach((t=>{this.playerSeenVoidInSuits[d][t.suit]||a.push(t)})),0===a.length&&console.error("ERROR: big assertion was wrong, no cards to move from 1st to 3rd");const u=a[Math.floor(Math.random()*a.length)];e[d].insert(u),e[r].remove(u),e[r].insert(t)}}})),this.gameHand.getHand(this.whoAmI).forEach((t=>{e[this.whoAmI].insert(t)})),this.cardsIPassed.forEach((t=>{e[i].insert(t)})),e}resetHand(){this.unknownCards.fill(),this.cardsIPassed.length=0,this.playerSeenVoidInSuits=[[!1,!1,!1,!1],[!1,!1,!1,!1],[!1,!1,!1,!1],[!1,!1,!1,!1]]}dealHands(){this.whoAmI,this.gameHand.getHand(this.whoAmI).forEach((t=>{this.unknownCards.remove(t),t.str()}))}pass(t,e,s){t===this.whoAmI&&(this.cardsIPassed=s.slice())}receivePassedCards(){this.whoAmI,this.gameHand.getHand(this.whoAmI).forEach((t=>{this.unknownCards.remove(t),t.str()}))}resetTrick(){}seeCardPlayed(t,e,s=!1){this.unknownCards.remove(t);let i=-1;this.cardsIPassed.forEach(((e,s)=>{t.value===e.value&&t.suit===e.suit&&(i=s)})),-1!==i&&this.cardsIPassed.splice(i,1);const a=this.gameHand.getPlayedCards()[this.gameHand.getTrickLeader()].suit;t.suit!==a&&(this.playerSeenVoidInSuits[e][a]=!0),s&&(this.playerSeenVoidInSuits[e][h.default.CLUBS]=!0,this.playerSeenVoidInSuits[e][h.default.DIAMONDS]=!0,this.playerSeenVoidInSuits[e][h.default.SPADES]=!0)}staticPlayAI(){const t=this.gameHand.findValidChoices();if(this.gameHand.getPlayedCardCount()>0){const e=this.gameHand.getPlayedCards()[this.gameHand.getTrickLeader()];if(t[0].suit===e.suit){if(t[0].value<e.value){for(let s=t.length-1;s>=0;--s)if(t[s].value<e.value)return 13===t[s].value&&t[s].suit===h.default.SPADES&&s>0&&12===t[s-1].value?t[s-1]:t[s];return console.error("ERROR: should never get here"),t[0]}if(this.gameHand.getPlayedCardCount()<3)return e.suit===h.default.SPADES&&12===t[0].value&&t.length>1?t[1]:t[0];{const s=t[t.length-1];return e.suit===h.default.SPADES&&12===s.value&&t.length>1?t[t.length-2]:s}}{const e=[];for(let s=t.length-1;s>=0;--s)if(t[s].suit===h.default.SPADES){if(!(t[s].value>11))break;e.push(t[s])}if(e.length)return e[e.length-1];{let e=t[0].suit,s=e,i=t[0].value;for(let a=1;a<t.length;++a)t[a].suit!==e&&(e=t[a].suit,t[a].value>i&&(s=e,i=t[a].value));const a=this.gameHand.getHand(this.gameHand.getWhoseTurn()).getSuit(s);return a[a.length-1]}}}{const e=t.filter((t=>t.value<12||t.suit!==h.default.SPADES));return e.length?e[Math.floor(Math.random()*e.length)]:t[0]}}simPlayCard(){const t=this.gameHand.getHand(this.gameHand.getWhoseTurn()).length(),e=this.gameHand.getShootMoonPossible()?t>12?10:-.8*t+11.5:2;if(10*Math.random()<e){const t=this.gameHand.findValidChoices();return t[Math.floor(Math.random()*t.length)]}return this.staticPlayAI()}dynamicPlay(){const t=this.gameHand.findValidChoices();if(1===t.length)return t[0];const e=t.map((()=>0)),s=Math.floor(r.LEVEL/t.length/this.gameHand.getHand(this.gameHand.getWhoseTurn()).length())+1;for(let i=s;i>0;--i)t.forEach(((t,s)=>{const i=new n.default(this.gameHand),a=new r(i,this.whoAmI);i.setHands(this.speculateHands(i.getPassingDirection())),i.playCard(t);do{for(;i.turnsLeftInTrick();)i.playCard(a.simPlayCard());i.endTrick(),i.getHand(0).length()&&i.resetTrick()}while(i.getHand(0).length());i.endHand(),e[s]+=i.getScore(this.whoAmI)}));let i=0;t[0].str(),e[0];for(let s=1;s<t.length;++s)e[s]<e[i]&&(i=s),t[s].str(),e[s];return t[i]}}r.LEVEL=1e4,e.default=r},196:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0});const s=new Map([[2,"2"],[3,"3"],[4,"4"],[5,"5"],[6,"6"],[7,"7"],[8,"8"],[9,"9"],[10,"0"],[11,"j"],[12,"q"],[13,"k"],[14,"a"],[0,""]]),i=new Map([[0,"c"],[1,"d"],[2,"s"],[3,"h"]]);class a{constructor(t,e){if(t.hasOwnProperty("suit")){const e=t;this.value=e.value,this.suit=e.suit}else this.value=t,this.suit=e}static find(t,e){let s=0,i=t.length,a=i>>1;for(;a<i;){if(t[a].value===e.value)return a;t[a].value>e.value?i=a:s=a+1,a=s+i>>1}return-1}str(){let t;switch(this.value){case 1:case 14:t="Ace of ";break;case 11:t="Jack of ";break;case 12:t="Queen of ";break;case 13:t="King of ";break;default:t=this.value.toString(),t+=" of "}switch(this.suit){case a.CLUBS:t+="Clubs";break;case a.DIAMONDS:t+="Diamonds";break;case a.SPADES:t+="Spades";break;case a.HEARTS:t+="Hearts";break;default:t+="UNKNOWN SUIT"}return t}hash(){return(this.value<<2)+this.suit}code(){const t=s.get(this.value),e=i.get(this.suit);return t&&e?t+e:(console.error("ERROR: failed to get a code from card",this),"")}}a.CLUBS=0,a.DIAMONDS=1,a.SPADES=2,a.HEARTS=3,a.SUIT_COUNT=4,e.default=a},201:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0});class s{static getAssetCoords(t){return{assetX:((14===t.value?1:t.value)-1)*s.valueXMult,assetY:s.suitAssetYs[t.suit]}}static get assets(){return s._assets||(s._assets=document.getElementById("a")),s._assets}}s.suitAssetYs=[0,528,352,176],s.assetHeight=156,s.valueXMult=131.5834,s.assetWidth=112,e.default=s},477:function(t,e,s){var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s(196));e.default=class{constructor(t){this.cards=[[],[],[],[]],t&&t.cards.forEach(((t,e)=>{t.forEach((t=>{this.cards[e].push(new a.default(t))}))}))}length(t=-1){return-1===t?this.cards[0].length+this.cards[1].length+this.cards[2].length+this.cards[3].length:this.cards[t].length}getSuitAndIndex(t){let e=0;for(;e<4&&t>=this.cards[e].length;)t-=this.cards[e].length,e+=1;return e<4?{suit:e,index:t}:null}at(t){const e=this.getSuitAndIndex(t);return e?this.cards[e.suit][e.index]:null}forEach(t){let e=0;this.cards.forEach((s=>{s.forEach((s=>{t(s,e),++e}))}))}find(t){let e=a.default.find(this.cards[t.suit],t);if(-1===e)return-1;for(let s=0;s<t.suit;++s)e+=this.cards[s].length;return e}remove(t){let e,s;if(t.hasOwnProperty("suit")){const i=t;if(s=this.cards[i.suit],e=a.default.find(s,i),-1===e)return}else{const i=this.getSuitAndIndex(t);if(!i)return;s=this.cards[i.suit],e=i.index}s.splice(e,1)}insert(t){const e=this.cards[t.suit];let s=0;for(;s<e.length&&!(e[s].value>t.value);++s);e.splice(s,0,t)}clear(){this.cards.forEach((t=>{t.length=0}))}fill(){this.cards.forEach(((t,e)=>{t.length=0;for(let s=2;s<15;++s)t.push(new a.default(s,e))}))}dealOne(){const t=Math.floor(Math.random()*this.length()),e=this.at(t);return this.remove(t),e}pickRandom(t){const e=[],s=[0,1,2,3,4,5,6,7,8,9,10,11,12];!function(t){for(let e=t.length-1;e>0;--e){const s=Math.floor(Math.random()*(e+1));[t[e],t[s]]=[t[s],t[e]]}}(s);for(let i=0;i<t;++i)e.push(this.at(s[i]));return e}getSuit(t){return this.cards[t]}slice(){return this.cards[0].concat(this.cards[1],this.cards[2],this.cards[3])}}},222:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0});e.RectClickable=class{constructor(t,e,s,i,a,n){this.x=t,this.y=e,this.w=s,this.h=i,this.onClick=a,this.allowedWhileWaiting=(null==n?void 0:n.allowedWhileWaiting)||!1,this.code=(null==n?void 0:n.code)||""}contains(t,e){return t>=this.x&&e>=this.y&&t<this.x+this.w&&e<this.y+this.h}codeMatch(t){return t===this.code}};e.CircleClickable=class{constructor(t,e,s,i,a){this.x=t,this.y=e,this.r=s,this.onClick=i,this.allowedWhileWaiting=(null==a?void 0:a.allowedWhileWaiting)||!1,this.code=(null==a?void 0:a.code)||""}contains(t,e){const s=Math.pow(this.r,2);return Math.pow(t-this.x,2)+Math.pow(e-this.y,2)<=s}codeMatch(t){return t===this.code}}},651:function(t,e,s){var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s(196)),n=s(222),h=s(343),r=i(s(489)),o=i(s(201)),d=s(257);class l{constructor(){this.fromX=.4,this.fromY=-1,this.toX=this.fromX,this.toY=this.fromY,this.frame=0,this.endFrame=10}current(){if(0===this.endFrame)return[this.toX,this.toY];const t=this.toX-this.fromX,e=this.toY-this.fromY,s=this.frame/this.endFrame;return[s*t+this.fromX,s*e+this.fromY]}setLocation(t,e){this.fromX=t,this.fromY=e,this.toX=t,this.toY=e,this.frame=this.endFrame}setDestination(t,e){return(Math.abs(this.toX-t)>.0078125||Math.abs(this.toY-e)>.0078125)&&([this.fromX,this.fromY]=this.current(),this.toX=t,this.toY=e,this.endFrame=10,this.frame=0),this.current()}update(){this.frame+=this.frame<this.endFrame?1:0}}class c{constructor(t,e){this.cardWidth=42,this.cardHeight=58.5,this.vertical=!1,this.fontSize=18,this.context=t,this.gui=e,this.menu=new r.default(t,this.gui),this.cardAnimations=new Map;for(let t=2;t<15;++t)for(let e=0;e<a.default.SUIT_COUNT;++e)this.cardAnimations.set((t<<2)+e,new l);this.context.font=this.fontSize+"px Arial",this.context.textBaseline="top"}resize(t){this.vertical=this.context.canvas.height>1.1*this.context.canvas.width,this.cardWidth=t*this.context.canvas.width/(this.vertical?5.4:10.6),this.cardHeight=this.cardWidth*o.default.assetHeight/o.default.assetWidth,this.cardWidth,this.menu.resize(this.cardWidth)}setAiCards(){for(let t=1;t<4;++t){const[e,s]=c.playerPosition(t);this.gui.game.hand.getHand(t).forEach(((t,i)=>{var a;null===(a=this.cardAnimations.get(t.hash()))||void 0===a||a.setLocation(e,s)}))}}drawCard(t,e,s){const{assetX:i,assetY:a}=o.default.getAssetCoords(t),n=this.context.canvas,h=n.width,r=n.height,d=this.cardAnimations.get(t.hash());if(!d)throw"anim not found with card "+t.str();const[l,c]=d.setDestination(e/h,s/r);this.context.drawImage(o.default.assets,i,a,o.default.assetWidth,o.default.assetHeight,l*h,c*r,this.cardWidth,this.cardHeight),d.update()}static startsNewSuit(t,e){return 0===t||!(t>=e.length())&&e.at(t-1).suit!==e.at(t).suit}static getRowBreak(t){const e=t.length();let s=e>>1;if(c.startsNewSuit(s,t))return s;{let i=t.length(0)+t.length(1)>s?1:-1;s+=i;const a=e-8;for(;s>a&&s<8;){if(c.startsNewSuit(s,t))return s;s+=i}for(i=0-i,s=(e>>1)+i;s>a&&s<8;){if(c.startsNewSuit(s,t))return s;s+=i}return e>>1}}drawHand(t){const e=this.gui.game.hand.getHand(0),s=e.length(),i=[[],[]];let a=0;this.vertical&&s>7&&(a=c.getRowBreak(e));let h=0;e.forEach(((t,e)=>{e>=a&&(h=1),i[h].push({card:t,index:e})}));let r=this.context.canvas.height-2*(this.cardHeight+c.verticalPadding);const o=Math.max(i[0].length,i[1].length),d=o>Math.floor(this.context.canvas.width/(1.05*this.cardWidth))?(this.context.canvas.width-(this.cardWidth+10))/(o-1):1.05*this.cardWidth;i.forEach((e=>{const s=this.context.canvas.width/2-(d*(e.length-1)+this.cardWidth)/2;e.forEach(((e,i)=>{if(-1===this.gui.cardsToPass.find(e.card)){const a=s+d*i;this.drawCard(e.card,a,r),this.gui.clickables.push(new n.RectClickable(a,r,this.cardWidth,this.cardHeight,(()=>{t(e.card)}),{code:e.card.code()}))}})),r+=this.cardHeight+c.verticalPadding}))}drawPlayerScore(t,e,s){this.context.fillText("Game: "+this.gui.game.scores[t],e,s),this.context.fillText("Hand: "+this.gui.game.hand.getScore(t),e,s+this.fontSize)}drawScores(){this.context.font=this.fontSize+"px Arial",this.context.textBaseline="top",this.context.fillStyle=h.scoreTextColor,this.context.fillText(`Game: ${this.gui.game.scores[0]}  Hand: ${this.gui.game.hand.getScore(0)}`,5,this.yForBottomMiddle()+(this.cardHeight+c.verticalPadding)),this.drawPlayerScore(1,5,this.context.canvas.height/4),this.drawPlayerScore(2,(this.context.canvas.width+this.cardWidth+10)/2,5);const t=this.context.measureText("Game: 100").width;this.drawPlayerScore(3,this.context.canvas.width-(t+5),this.context.canvas.height/3)}yForBottomMiddle(){return this.context.canvas.height-((this.vertical?3:2)*(this.cardHeight+c.verticalPadding)+c.spaceAboveHand)}drawCardsToPass(){const t=this.yForBottomMiddle();let e=this.context.canvas.width/2-(1.5*this.cardWidth+10);this.gui.cardsToPass.forEach((s=>{this.drawCard(s,e,t),this.gui.clickables.push(new n.RectClickable(e,t,this.cardWidth,this.cardHeight,(()=>{this.gui.removeFromPass(s)}),{code:s.code()})),e+=this.cardWidth+10}))}drawPlayedCards(){const t=Math.min(this.yForBottomMiddle(),this.context.canvas.height/2),e=(this.context.canvas.width-this.cardWidth)/2,s=this.gui.game.hand.getPlayedCards();s[0].value&&this.drawCard(s[0],e,t),s[1].value&&this.drawCard(s[1],e-(10+this.cardWidth),t-(this.cardHeight/2+5)),s[2].value&&this.drawCard(s[2],e,t-(this.cardHeight+10)),s[3].value&&this.drawCard(s[3],e+(10+this.cardWidth),t-(this.cardHeight/2+5))}drawPreviousTrick(){if(4!==this.gui.game.hand.getPlayedCardCount()){const t=this.gui.game.hand.getPreviousTrick(),[e,s]=c.playerPosition(t.whoWon);for(let i of t.cards)this.drawCard(i,e*this.context.canvas.width,s*this.context.canvas.height)}}static playerPosition(t){return[t?t-1.6:.4,2===t?-.5:0===t?1.5:.2]}drawArrow(t,e,s,i,a){this.context.globalAlpha=a?1:.5,this.context.fillStyle=h.buttonColor,this.context.translate(t+s/2,e+s/2),this.context.rotate(i*Math.PI/2),this.context.beginPath(),this.context.moveTo(s/2,0),this.context.lineTo(0,0-s/2),this.context.lineTo(0,0-s/4),this.context.lineTo(0-s/2,0-s/4),this.context.lineTo(0-s/2,s/4),this.context.lineTo(0,s/4),this.context.lineTo(0,s/2),this.context.fill(),this.context.rotate(0-i*Math.PI/2),this.context.translate(0-(t+s/2),0-(e+s/2)),this.context.globalAlpha=1}drawPassButton(t){const e=this.context.canvas.width/2-40,s=this.context.canvas.height-((this.vertical?3:2)*(this.cardHeight+c.verticalPadding)+c.spaceAboveHand+c.verticalPadding+80);this.drawArrow(e,s,80,this.gui.game.getPassingDirection()+1,t),this.gui.clickables.push(new n.RectClickable(e,s,80,80,(()=>{this.gui.passButtonClick()}),{code:"p"}))}drawEnd(t){const e=t.length+1,s=this.fontSize+2,i=(e+2)*s,a=this.context.measureText(d.names[3]).width+2*s,n=(this.context.canvas.width-a)/2,r=(this.context.canvas.height-i)/2;this.context.fillStyle=h.menuColor,this.context.globalAlpha=h.menuAlpha,this.context.fillRect(n,r,a,i),this.context.globalAlpha=1,this.context.font=this.fontSize+"px Arial",this.context.textBaseline="top",this.context.fillStyle=h.menuTextColor,this.context.fillText("winner"+(t.length>1?"s:":":"),n+s,r+s),t.forEach(((t,e)=>{this.context.fillText(d.names[t],n+s,r+(e+2)*s)}))}background(){this.context.fillStyle=h.background,this.context.fillRect(0,0,this.context.canvas.width,this.context.canvas.height)}drawMenu(){this.menu.draw(this.gui.clickables)}}c.verticalPadding=5,c.spaceAboveHand=20,e.default=c},421:function(t,e,s){var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s(465));class n{constructor(t){this.hand=new a.default,this.scores=[0,0,0,0],this.winners=[],this.passingIndex=0,t&&(this.hand=new a.default(t.hand),this.scores=t.scores,this.winners=t.winners,this.passingIndex=t.passingIndex)}reset(){this.winners.length=0,this.passingIndex=0,this.scores[0]=0,this.scores[1]=0,this.scores[2]=0,this.scores[3]=0}endHand(){let t=!1;for(let e=0;e<4;++e)this.scores[e]+=this.hand.getScore(e),this.scores[e]>99&&(t=!0);if(t){this.winners.push(0);for(let t=1;t<4;++t)this.scores[t]<this.scores[this.winners[0]]?(this.winners.length=0,this.winners.push(t)):this.scores[t]===this.scores[this.winners[0]]&&this.winners.push(t)}else this.changePassing()}changePassing(){this.passingIndex=(this.passingIndex+1)%4}getPassingDirection(){return n.passingDirections[this.passingIndex]}}n.passingDirections=[1,3,2,0],e.default=n},465:function(t,e,s){var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s(477)),n=i(s(196)),h=new n.default(0,0);e.default=class{constructor(t){if(this.hands=[new a.default,new a.default,new a.default,new a.default],this.scores=[0,0,0,0],this.passingDirection=0,this.passedCardsToPlayer=[[],[],[],[]],this.passCount=0,this.playedCards=[h,h,h,h],this.playedCardCount=0,this.trickLeader=0,this.whoseTurn=0,this.heartsBroken=!1,this.pointsPlayedThisTrick=!1,this._trickHistory=[],this.shootMoonPossible=!0,this.observerList=[],t){this.hands[0]=new a.default(t.hands[0]),this.hands[1]=new a.default(t.hands[1]),this.hands[2]=new a.default(t.hands[2]),this.hands[3]=new a.default(t.hands[3]),this.scores=t.scores.map((t=>t)),this.passingDirection=t.passingDirection;for(let e=0;e<4;++e)this.passedCardsToPlayer[e].length=0,t.passedCardsToPlayer[e].forEach((t=>{this.passedCardsToPlayer[e].push(new n.default(t))}));this.passCount=t.passCount,this.playedCards[0]=new n.default(t.playedCards[0]),this.playedCards[1]=new n.default(t.playedCards[1]),this.playedCards[2]=new n.default(t.playedCards[2]),this.playedCards[3]=new n.default(t.playedCards[3]),this.playedCardCount=t.playedCardCount,this.trickLeader=t.trickLeader,this.whoseTurn=t.whoseTurn,this.heartsBroken=t.heartsBroken,this.pointsPlayedThisTrick=t.pointsPlayedThisTrick,t._trickHistory?this._trickHistory=t._trickHistory.map((t=>({cards:t.cards.map((t=>new n.default(t))),whoWon:t.whoWon}))):t.trickHistory?this._trickHistory=t.trickHistory.map((t=>({cards:t.cards.map((t=>new n.default(t))),whoWon:t.whoWon}))):this._trickHistory=[],this.shootMoonPossible=t.shootMoonPossible}}get trickHistory(){return this._trickHistory}registerObserver(t){this.observerList.push(t)}getWhoseTurn(){return this.whoseTurn}getHand(t){return this.hands[t]}getScore(t){return this.scores[t]}getPassingDirection(){return this.passingDirection}turnsLeftInTrick(){return 4-this.playedCardCount}heartsIsBroken(){return this.heartsBroken}getPassCount(){return this.passCount}getPlayedCards(){return this.playedCards}getPlayedCardCount(){return this.playedCardCount}getPreviousTrick(){const t=this._trickHistory.length;return t?this._trickHistory[t-1]:{cards:[],whoWon:0}}getTrickLeader(){return this.trickLeader}getPassedCardsToPlayer(t){return this.passedCardsToPlayer[t]}getShootMoonPossible(){return this.shootMoonPossible}setPassed(){this.passCount=4}setHands(t){this.hands=t}resetHand(t){this.passingDirection=t;for(let t=0;t<4;++t)this.hands[t].clear(),this.scores[t]=0,this.passedCardsToPlayer[t].length=0;this.passCount=0,this.heartsBroken=!1,this._trickHistory.length=0,this.shootMoonPossible=!0,this.observerList.forEach((t=>{t.resetHand()}))}dealHands(){const t=new a.default;for(t.fill();t.length();)for(let e=0;e<4;++e){const s=t.dealOne();this.hands[e].insert(s),2===s.value&&s.suit===n.default.CLUBS&&(this.whoseTurn=e)}this.observerList.forEach((t=>{t.dealHands()}))}pass(t,e,s){s.forEach((s=>{this.passedCardsToPlayer[e].push(s),this.hands[t].remove(s)})),++this.passCount,this.observerList.forEach((i=>{i.pass(t,e,s)}))}receivePassedCards(){for(let t=0;t<4;++t)this.passedCardsToPlayer[t].forEach((e=>{this.hands[t].insert(e),2===e.value&&e.suit===n.default.CLUBS&&(this.whoseTurn=t)}));this.observerList.forEach((t=>{t.receivePassedCards()}))}resetTrick(){this.playedCards=[h,h,h,h],this.playedCardCount=0,this.trickLeader=this.whoseTurn,this.pointsPlayedThisTrick=!1,this.observerList.forEach((t=>{t.resetTrick()}))}takesLead(t){return t.suit===this.playedCards[this.trickLeader].suit&&t.value>this.playedCards[this.trickLeader].value}playCard(t){this.hands[this.whoseTurn].remove(t),this.playedCards[this.whoseTurn]=t,++this.playedCardCount,this.takesLead(t)&&(this.trickLeader=this.whoseTurn);let e=!1;t.suit===n.default.HEARTS&&(1!==this.playedCardCount||this.heartsBroken||(e=!0),this.heartsBroken=!0),this.pointsFor(t)&&(this.pointsPlayedThisTrick=!0);const s=this.whoseTurn;if(this.shootMoonPossible&&this.pointsPlayedThisTrick){let t=-1;for(let e=0;e<4;++e)if(this.getScore(e)){t=e;break}if(-1!==t){let e=!1,i=(s+5-this.getPlayedCardCount())%4;for(let s=this.getPlayedCardCount();s>0;--s){if(i===t){e=!0;break}i=(i+1)%4}e&&t!==this.getTrickLeader()&&(this.shootMoonPossible=!1)}}this.whoseTurn=(this.whoseTurn+1)%4,this.observerList.forEach((i=>{i.seeCardPlayed(t,s,e)}))}pointsFor(t){return t.suit===n.default.HEARTS?1:12===t.value&&t.suit===n.default.SPADES?13:0}endTrick(){this.playedCards.forEach((t=>{this.scores[this.trickLeader]+=this.pointsFor(t)})),this.whoseTurn=this.trickLeader,this._trickHistory.push({cards:this.playedCards.slice(),whoWon:this.trickLeader})}endHand(){this.playedCards=[h,h,h,h],this.playedCardCount=0;for(let t=0;t<4;++t){if(26===this.scores[t]){this.scores[t]=0;for(let e=0;e<4;++e)e!==t&&(this.scores[e]=26);return t}if(this.scores[t]>0)return-1}return alert("this should never happen, invalid scores"),-2}findValidChoices(){const t=this.hands[this.whoseTurn];if(13===t.length()){if(0===this.playedCardCount)return[new n.default(2,n.default.CLUBS)];if(t.length(n.default.CLUBS))return t.getSuit(n.default.CLUBS);{const e=[];return t.forEach((t=>{this.pointsFor(t)||e.push(t)})),e.length?e:t.slice()}}if(0===this.playedCardCount){if(this.heartsBroken)return t.slice();if(t.length(n.default.HEARTS)===t.length())return t.slice();const e=[];return t.forEach((t=>{t.suit!==n.default.HEARTS&&e.push(t)})),e}return t.length(this.playedCards[this.trickLeader].suit)?t.getSuit(this.playedCards[this.trickLeader].suit):t.slice()}}},402:function(t,e,s){var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s(196)),n=i(s(421)),h=i(s(19)),r=i(s(477)),o=i(s(12)),d=i(s(651)),l=i(s(313)),c=s(886);class u{constructor(t,e){this.clickables=[],this.cardsToPass=new r.default,this.humanPlayerPassed=!1,this.receivedCards=[],this.showingPassedCards=!1,this.waiter=new o.default,this.lastKey="",this.storage=e,this.stats=new l.default(e),this.worker=new Worker("workerbundle.js"),this.worker.addEventListener("message",(t=>{this.handleMessage(t.data)})),this.restore(),this.drawer=new d.default(t,this),this.drawer.setAiCards(),setInterval((()=>{this.draw()}),40)}getStatData(){return this.stats.get()}resize(t){this.drawer.resize(t)}static filterOutObserverList(t,e){return"observerList"===t?void 0:e}workerMessagePassing(){const t=JSON.parse(JSON.stringify(this.ais,u.filterOutObserverList));this.worker.postMessage(t)}workerMessagePlay(){this.game.hand.getWhoseTurn();const t=JSON.parse(JSON.stringify(this.ais[this.game.hand.getWhoseTurn()],u.filterOutObserverList));this.worker.postMessage(t)}deleteSave(){this.storage.removeItem("game"),this.storage.removeItem("ais"),this.storage.removeItem("hpp")}save(){const t=JSON.stringify(this.game,u.filterOutObserverList),e=JSON.stringify(this.ais,u.filterOutObserverList);this.storage.setItem("game",t),this.storage.setItem("ais",e),this.storage.setItem("hpp",this.humanPlayerPassed?"t":"f")}restore(){const t=this.storage.getItem("game"),e=this.storage.getItem("ais"),s=this.storage.getItem("hpp");if(this.humanPlayerPassed="t"===s,t&&e){const s=JSON.parse(e);this.game=new n.default(JSON.parse(t)),this.ais=[null,new h.default(s[1]),new h.default(s[2]),new h.default(s[3])],this.ais[1].setHand(this.game.hand),this.ais[2].setHand(this.game.hand),this.ais[3].setHand(this.game.hand)}else this.game=new n.default,this.ais=[null,new h.default(this.game.hand,1),new h.default(this.game.hand,2),new h.default(this.game.hand,3)];for(let t=1;t<4;++t)this.game.hand.registerObserver(this.ais[t]);this.game.hand.registerObserver(this),t||(this.game.reset(),this.game.hand.resetHand(this.game.getPassingDirection()))}addToPass(t){t.str(),this.cardsToPass.length()<3&&(this.cardsToPass.insert(t),this.cardsToPass.length())}removeFromPass(t){t.str(),this.cardsToPass.remove(t)}playCard(t){t.str();this.game.hand.findValidChoices().some((e=>t.value===e.value&&t.suit===e.suit))&&this.game.hand.playCard(t)}passButtonClick(){if(!(this.cardsToPass.length()>2))return;this.humanPlayerPassed=!0;const t=this.cardsToPass.slice();this.cardsToPass.clear(),this.game.hand.pass(0,this.game.getPassingDirection(),t)}draw(){this.drawer.background(),this.clickables.length=0,this.drawer.drawScores(),this.humanPlayerPassed?this.game.hand.getPassCount()<4?this.drawer.drawHand((t=>{t.str()})):this.showingPassedCards?(this.cardsToPass.length(),this.drawer.drawHand((t=>{t.str()})),this.drawer.drawCardsToPass()):this.game.winners.length?(this.drawer.drawPreviousTrick(),this.drawer.drawEnd(this.game.winners)):(this.drawer.drawHand((t=>{this.playCard(t)})),this.drawer.drawPlayedCards(),this.drawer.drawPreviousTrick()):(this.drawer.drawHand((t=>{this.addToPass(t)})),this.drawer.drawCardsToPass(),this.drawer.drawPassButton(3===this.cardsToPass.length())),this.drawer.drawMenu()}click(t){for(let e=this.clickables.length-1;e>=0;--e)if("string"==typeof t&&this.clickables[e].codeMatch(t)||t instanceof MouseEvent&&this.clickables[e].contains(t.x,t.y)){if(this.clickables[e].allowedWhileWaiting)return this.clickables[e].onClick();if(this.waiter.click())return;return this.clickables[e].onClick()}this.waiter.click()}keyDown(t){if(c.cardCodes.has(this.lastKey)&&c.suitCodes.has(t)){const e=this.lastKey+t;this.click(e)}else"p"===t&&this.click(t);this.lastKey=t}handleMessage(t){if(t.value)this.game.hand.getWhoseTurn(),this.waiter.gotMessage(new a.default(t));else for(let e=1;e<4;++e){const s=(e+this.game.getPassingDirection())%4,i=[new a.default(t[e][0]),new a.default(t[e][1]),new a.default(t[e][2])];this.game.hand.pass(e,s,i)}}drawWait(t,e,s){return this.waiter.wait(t,e,s)}showReceivedCards(){return this.showingPassedCards=!0,this.drawWait(3,!0,!1).then((()=>{this.showingPassedCards=!1,this.cardsToPass.clear()}))}computerTurn(){this.workerMessagePlay(),this.drawWait(.5,!0,!0).then((t=>{this.game.hand.playCard(t)}))}resetHand(){this.game.hand.dealHands()}dealHands(){this.receivedCards.length=0,this.game.getPassingDirection()?(this.humanPlayerPassed=!1,this.workerMessagePassing()):(this.game.hand.setPassed(),this.humanPlayerPassed=!0,this.drawer.setAiCards(),this.game.hand.resetTrick())}receivePassedCards(){this.drawer.setAiCards(),this.game.hand.resetTrick()}resetTrick(){0!==this.game.hand.getWhoseTurn()?this.computerTurn():this.save()}pass(t,e,s){0===t&&(this.humanPlayerPassed=!0),4===this.game.hand.getPassCount()?(this.receivedCards=this.game.hand.getPassedCardsToPlayer(0).slice(),this.cardsToPass.clear(),this.cardsToPass.insert(this.receivedCards[0]),this.cardsToPass.insert(this.receivedCards[1]),this.cardsToPass.insert(this.receivedCards[2]),this.showReceivedCards().then((()=>{this.game.hand.receivePassedCards()}))):3===this.game.hand.getPassCount()&&this.save()}seeCardPlayed(t,e,s){4===this.game.hand.getPlayedCardCount()?(this.game.hand.getPlayedCards().some((t=>12===t.value&&t.suit===a.default.SPADES))&&this.stats.queen(this.game.hand.getTrickLeader()),this.game.hand.endTrick(),this.drawWait(2,!0,!1).then((()=>{if(this.game.hand.getHand(0).length())this.game.hand.resetTrick();else{const t=this.game.hand.endHand();this.game.endHand(),this.stats.hand(t),this.game.winners.length?(this.stats.game(this.game.scores),this.deleteSave(),this.drawWait(2,!1,!1).then((()=>{this.drawWait(1e6,!0,!1).then((()=>{this.game.reset(),this.game.hand.resetHand(this.game.getPassingDirection())}))}))):this.drawWait(this.drawer.menu.opened?1e6:.5,!0,!1).then((()=>{this.game.hand.resetHand(this.game.getPassingDirection())}))}}))):0!==this.game.hand.getWhoseTurn()?this.computerTurn():this.save()}}e.default=u},489:function(t,e,s){var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=s(222),n=s(343),h=s(699),r=i(s(849)),o=i(s(199));e.default=class{constructor(t,e){this.context=t,this.gui=e,this.opened=!1,this.sizeX=0,this.sizeY=0,this.fullX=128,this.fullY=128,this.menuButtonLines=[0,1,2],this.ptd=new r.default(t,e.game.hand.trickHistory),this.statD=new o.default(t,e.getStatData()),this.showingStats=!1,this.resize(64)}randomizeMenuButtonLines(){let t=Math.trunc(3*Math.random());[this.menuButtonLines[0],this.menuButtonLines[t]]=[this.menuButtonLines[t],this.menuButtonLines[0]],t=Math.trunc(2*Math.random())+1,[this.menuButtonLines[1],this.menuButtonLines[t]]=[this.menuButtonLines[t],this.menuButtonLines[1]]}menuDrawCalculations(){const t=this.context.canvas.width,e=this.context.canvas.height,s=20*Math.sqrt(Math.PI);return{width:t,height:e,radius:20,buttonSize:s,buttonSizeD2:s/2,padding:5,x:t-5-20,y:25,donHeight:40,donWidth:70}}resize(t){const{width:e,height:s,radius:i,buttonSize:n,buttonSizeD2:h,padding:r,x:o,y:d,donHeight:l,donWidth:c}=this.menuDrawCalculations();this.fullX=Math.trunc(160+(t-120+Math.sqrt(Math.pow(t-120,2)+80))/2+1.875*t),this.fullX=Math.min(this.fullX,e-2*i-2*r),this.fullY=this.fullX,this.rc={fullscreenCloseMenu:new a.RectClickable(0,0,e,s,(()=>{this.opened=!1,this.sizeX===this.fullX&&this.randomizeMenuButtonLines()}),{allowedWhileWaiting:!0}),menuOpenBlank:new a.RectClickable(o-this.fullX-h,d-h,this.fullX+n,this.fullY+n,(()=>{}),{allowedWhileWaiting:!0}),openMenuButton:new a.CircleClickable(o,d,i,(()=>{this.opened=!0,0===this.sizeX&&this.randomizeMenuButtonLines()}),{allowedWhileWaiting:!0}),closeMenuButton:new a.CircleClickable(o,d,i,(()=>{this.opened=!1,this.sizeX===this.fullX&&this.randomizeMenuButtonLines()}),{allowedWhileWaiting:!0}),donButton:new a.RectClickable(o-c,d+this.fullY-l,c,l,(()=>{window.open("https://www.patreon.com/user?u=44765751","_blank")}),{allowedWhileWaiting:!0}),menuItemToggle:new a.RectClickable(o-this.fullX,d+this.fullY-40,2*this.fullX/3,40,(()=>{this.showingStats=!this.showingStats}),{allowedWhileWaiting:!0})},this.ptd.resize(this.fullX,this.fullY,o,d),this.statD.resize(this.fullX,this.fullY,o,d)}draw(t){const{radius:e,buttonSizeD2:s,padding:i,x:a,y:r,donHeight:o,donWidth:d}=this.menuDrawCalculations();this.opened?(this.sizeX=Math.min(this.fullX,this.sizeX+this.fullX/8),this.sizeY=Math.min(this.fullY,this.sizeY+this.fullY/8),t.push(this.rc.fullscreenCloseMenu)):(this.sizeX=Math.max(0,this.sizeX-this.fullX/8),this.sizeY=Math.max(0,this.sizeY-this.fullY/8)),this.context.fillStyle=n.menuColor,this.context.globalAlpha=n.menuAlpha,h.roundedRect(this.context,a-this.sizeX-e,r-e,this.sizeX+2*e,this.sizeY+2*e,e),this.context.fill(),this.context.globalAlpha=1;const l=a-s+2*i,c=a+s-2*i,u=r-s+2*i,g=r+s-2*i,f=this.sizeY/this.fullY,m=[u,g,r];this.context.strokeStyle=n.menuTextColor;let w=m[this.menuButtonLines[0]],p=g,v=u,C=p-w,x=v-w;if(this.context.beginPath(),this.context.moveTo(c,w+f*x),this.context.lineTo(l,w+f*C),this.context.stroke(),w=m[this.menuButtonLines[1]],p=u,v=g,C=p-w,x=v-w,this.context.beginPath(),this.context.moveTo(c,w+f*x),this.context.lineTo(l,w+f*C),this.context.stroke(),this.context.globalAlpha=1-f,this.context.beginPath(),this.context.moveTo(c,m[this.menuButtonLines[2]]),this.context.lineTo(l,m[this.menuButtonLines[2]]),this.context.stroke(),this.context.globalAlpha=1,0===this.sizeX)t.push(this.rc.openMenuButton);else{const e=f*o,s=f*d;this.context.fillStyle=n.buttonColor,this.context.fillRect(a-s,r+this.sizeY-e,s,e),this.context.fillStyle=n.menuTextColor;Math.trunc(18*f)>5&&(this.context.font=Math.trunc(18*f)+"px Arial",this.context.textBaseline="top",this.context.fillText("Donate",a-.9*s,r+this.sizeY-.72*e));const i=34*f,h=r+this.sizeY-3*f,l=this.sizeX/5,c=l/3,u=a-5*this.sizeX/6-1.5*c;this.context.fillStyle=n.menuTextColor,this.context.beginPath(),this.context.moveTo(u,h),this.context.lineTo(u,h-i/3),this.context.lineTo(u+c,h-i/3),this.context.moveTo(u+c,h),this.context.lineTo(u+c,h-i),this.context.lineTo(u+2*c,h-i),this.context.lineTo(u+2*c,h),this.context.moveTo(u+2*c,h-2*i/3),this.context.lineTo(u+3*c,h-2*i/3),this.context.lineTo(u+3*c,h),this.context.stroke();const g=a-this.sizeX/2,m=i/2;this.context.beginPath(),this.context.ellipse(g,h-m,m,m,0,0,2*Math.PI),this.context.stroke(),this.context.beginPath(),this.context.ellipse(g,h-m,m/3,m/3,0,0,2*Math.PI),this.context.stroke(),this.context.beginPath(),this.context.ellipse(g,h-m,l/2,m,0,0,2*Math.PI),this.context.stroke(),this.sizeX===this.fullX&&(t.push(this.rc.menuOpenBlank),this.context.strokeRect(a-this.sizeX+(this.showingStats?(this.statD.draw(t),0):(this.ptd.draw(t),this.sizeX/3)),r+this.sizeY-40,this.sizeX/3,40),t.push(this.rc.closeMenuButton),t.push(this.rc.donButton),t.push(this.rc.menuItemToggle))}}}},724:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0});e.default=class{constructor(t){this.context=t,this.menuWidth=128,this.menuHeight=128,this.menuRightX=295,this.menuTopY=25}resize(t,e,s,i){this.menuWidth=t,this.menuHeight=e,this.menuRightX=s,this.menuTopY=i}}},849:function(t,e,s){var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s(201)),n=s(222),h=s(343),r=s(699),o=i(s(724));class d extends o.default{constructor(t,e){super(t),this.trickHistory=e,this.current=-1,this.prevLength=0}get cardWidth(){return.33333*this.menuWidth}darkenCard(t,e,s,i){this.context.fillStyle="rgba(0, 0, 0, 0.25)",r.roundedRect(this.context,t,e,s,i,.0268*s),this.context.fill()}drawCard(t,e,s,i){const{assetX:n,assetY:h}=a.default.getAssetCoords(t),r=this.cardWidth,o=r/a.default.assetWidth*a.default.assetHeight;this.context.drawImage(a.default.assets,n,h,a.default.assetWidth,a.default.assetHeight,e,s,r,o),i||this.darkenCard(e,s,r,o)}draw(t){this.prevLength!==this.trickHistory.length&&(this.prevLength=this.trickHistory.length,this.current=this.trickHistory.length-1);const e=this.trickHistory[this.current];if(e){const t=this.cardWidth,s=t/a.default.assetWidth*a.default.assetHeight;this.drawCard(e.cards[1],this.menuRightX-this.menuWidth+t/2,this.menuTopY+s/4,1===e.whoWon),this.drawCard(e.cards[2],this.menuRightX-this.menuWidth/2-t/2,this.menuTopY,2===e.whoWon),this.drawCard(e.cards[0],this.menuRightX-this.menuWidth/2-t/2,this.menuTopY+s/2,0===e.whoWon),this.drawCard(e.cards[3],this.menuRightX-this.menuWidth/2,this.menuTopY+s/4,3===e.whoWon)}const s=this.menuTopY+this.menuHeight/3,i=25,r=20;if(this.current<this.trickHistory.length-1){const e=this.menuRightX-i;this.context.fillStyle=h.buttonColor,this.context.beginPath(),this.context.moveTo(this.menuRightX,s),this.context.lineTo(e,s+r),this.context.lineTo(e,s-r),this.context.fill(),t.push(new n.RectClickable(e-12.5,s-40,50,80,(()=>{++this.current}),{allowedWhileWaiting:!0}))}if(this.current>0){const e=this.menuRightX-this.menuWidth+i;this.context.fillStyle=h.buttonColor,this.context.beginPath(),this.context.moveTo(e-i,s),this.context.lineTo(e,s+r),this.context.lineTo(e,s-r),this.context.fill(),t.push(new n.RectClickable(e-37.5,s-40,50,80,(()=>{--this.current}),{allowedWhileWaiting:!0}))}}}e.default=d},199:function(t,e,s){var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s(724)),n=s(343),h=s(257);class r extends a.default{constructor(t,e){super(t),this.stats=e,this.columns=[0,0,0,0]}resize(...t){super.resize(...t),this.columns=[.24*this.menuWidth,.43*this.menuWidth,.62*this.menuWidth,.81*this.menuWidth]}draw4columns(t,e,s,i){this.context.fillText(t,e,s);for(let t=0;t<4;++t)this.context.fillText(i[t],e+this.columns[t],s)}draw(t){const e=(this.menuHeight-45)/15;this.context.font=Math.trunc(e-1)+"px Arial",this.context.textBaseline="top",this.context.fillStyle=n.menuTextColor;const s=this.menuRightX-this.menuWidth;let i=this.menuTopY+e;this.draw4columns("",s,i,h.names);const a=[0,1,2,3];i+=e,this.stats.gameCount&&(this.context.fillText("games: "+this.stats.gameCount,s,i,this.menuWidth),i+=e,this.draw4columns("avg:",s,i,a.map((t=>""+(this.stats.scoreTotals[t]/this.stats.gameCount).toFixed(0)))),i+=e,this.draw4columns("best:",s,i,a.map((t=>""+this.stats.bestScores[t]))),i+=e,this.draw4columns("worst:",s,i,a.map((t=>""+this.stats.worstScores[t]))),i+=e,this.draw4columns("1st:",s,i,a.map((t=>(100*this.stats.placeCounts[0][t]/this.stats.gameCount).toFixed(0)+"%"))),i+=e,this.draw4columns("2nd:",s,i,a.map((t=>(100*this.stats.placeCounts[1][t]/this.stats.gameCount).toFixed(0)+"%"))),i+=e,this.draw4columns("3rd:",s,i,a.map((t=>(100*this.stats.placeCounts[2][t]/this.stats.gameCount).toFixed(0)+"%"))),i+=e,this.draw4columns("4th:",s,i,a.map((t=>(100*this.stats.placeCounts[3][t]/this.stats.gameCount).toFixed(0)+"%")))),i+=e,this.stats.handCount&&(i+=e,this.context.fillText("hands: "+this.stats.handCount,s,i,this.menuWidth),i+=e,this.draw4columns("avg:",s,i,a.map((t=>""+(this.stats.scoreTotals[t]/this.stats.handCount).toFixed(1)))),i+=e,this.draw4columns("queen:",s,i,a.map((t=>(100*this.stats.queenCount[t]/this.stats.handCount).toFixed(0)+"%"))),i+=e,this.draw4columns("moon:",s,i,a.map((t=>(100*this.stats.moonCount[t]/this.stats.handCount).toFixed(0)+"%"))))}}e.default=r},313:function(t,e){var s=this&&this.__awaiter||function(t,e,s,i){return new(s||(s=Promise))((function(a,n){function h(t){try{o(i.next(t))}catch(t){n(t)}}function r(t){try{o(i.throw(t))}catch(t){n(t)}}function o(t){var e;t.done?a(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(h,r)}o((i=i.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(t){if(this.gameCount=0,this.handCount=0,this.placeCounts=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],this.scoreTotals=[0,0,0,0],this.bestScores=[999,999,999,999],this.worstScores=[0,0,0,0],this.moonCount=[0,0,0,0],this.queenCount=[0,0,0,0],t){const e=JSON.parse(t);this.gameCount=e.gameCount,this.handCount=e.handCount,this.placeCounts=e.placeCounts,this.scoreTotals=e.scoreTotals,this.bestScores=e.bestScores,this.worstScores=e.worstScores,this.moonCount=e.moonCount,this.queenCount=e.queenCount}}}e.StatData=i;e.default=class{constructor(t){this.data=new i,this.queenWho=-1,this.storage=t,this.lastRequestedPersist=Date.now()-3603600,this.init()}init(){const t=this.storage.getItem("statData");this.data=t?new i(t):new i}get(){return this.data}save(){return s(this,void 0,void 0,(function*(){this.storage.setItem("statData",JSON.stringify(this.data));const t=Date.now();if(navigator.storage.persisted(),this.lastRequestedPersist,navigator.storage&&navigator.storage.persist&&t>this.lastRequestedPersist+36e5&&!(yield navigator.storage.persisted())){yield navigator.storage.persist();this.lastRequestedPersist=t}}))}queen(t){this.queenWho=t}hand(t){++this.data.handCount,-1===this.queenWho?console.error("ERROR: Stats: hand called without queen"):++this.data.queenCount[this.queenWho],this.queenWho=-1,-1!==t&&++this.data.moonCount[t],this.save()}game(t){++this.data.gameCount;const e=t.slice().sort(((t,e)=>t-e));t.forEach(((t,s)=>{this.data.scoreTotals[s]+=t,t<this.data.bestScores[s]&&(this.data.bestScores[s]=t),t>this.data.worstScores[s]&&(this.data.worstScores[s]=t);const i=e.indexOf(t);++this.data.placeCounts[i][s]})),this.save()}}},12:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0});e.default=class{constructor(){this.waiting=!1,this.waitingTime=!1,this.clickSkips=!0,this.currentWait=null,this.needMessage=!1,this.haveMessage=!1,this.messageData=void 0,this.resolve=()=>{}}click(){return!(!this.waitingTime||!this.clickSkips)&&(clearTimeout(this.currentWait),this.waitingTime=!1,this.checkFinish(),!0)}wait(t,e,s){return this.waiting=!0,this.waitingTime=!0,this.clickSkips=e,this.needMessage=s,this.haveMessage=!1,this.needMessage,this.currentWait=setTimeout((()=>{this.waitingTime=!1,this.checkFinish()}),1e3*t),new Promise(((t,e)=>{this.resolve=t,this.checkFinish()}))}gotMessage(t){this.needMessage&&(this.haveMessage=!0,this.messageData=t,this.checkFinish())}checkFinish(){!this.waiting||this.waitingTime||this.needMessage&&!this.haveMessage||(this.waiting=!1,this.needMessage=!1,this.haveMessage=!1,this.resolve(this.messageData),this.messageData=void 0,this.resolve=()=>{})}}},343:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.menuColor="rgb(207,175,223)",e.menuAlpha=.875,e.menuTextColor="rgb(0,0,0)",e.buttonColor="rgb(255,165,0)",e.background="rgb(128,0,128)",e.scoreTextColor="#88ff88"},699:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.roundedRect=function(t,e,s,i,a,n){t.beginPath(),t.moveTo(e+n,s),t.lineTo(e+i-n,s),t.arcTo(e+i,s,e+i,s+n,n),t.lineTo(e+i,s+a-n),t.arcTo(e+i,s+a,e+i-n,s+a,n),t.lineTo(e+n,s+a),t.arcTo(e,s+a,e,s+a-n,n),t.lineTo(e,s+n),t.arcTo(e,s,e+n,s,n)}},996:function(t,e,s){var i=this&&this.__awaiter||function(t,e,s,i){return new(s||(s=Promise))((function(a,n){function h(t){try{o(i.next(t))}catch(t){n(t)}}function r(t){try{o(i.throw(t))}catch(t){n(t)}}function o(t){var e;t.done?a(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(h,r)}o((i=i.apply(t,e||[])).next())}))},a=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=a(s(402));var h=document.getElementById("c"),r=window.localStorage;const o=new n.default(h.getContext("2d"),r);function d(){window.devicePixelRatio,h.width=window.innerWidth,h.height=Math.max(window.innerHeight,document.documentElement.clientHeight),o.resize(Math.min(window.devicePixelRatio,1)),o.draw()}window.addEventListener("resize",d,!1),h.addEventListener("click",(function(t){o.click(t)}),!1),window.addEventListener("keydown",(function(t){o.keyDown(t.key)}),!1),window.onorientationchange=function(){const t=document.getElementsByTagName("html")[0],e=document.getElementsByTagName("body")[0];window.innerWidth<window.innerHeight?(t.style.overflowX="hidden",e.style.overflowX="hidden"):(t.style.overflowX="auto",e.style.overflowX="auto")},window.onload=function(){d(),function(){i(this,void 0,void 0,(function*(){if("serviceWorker"in navigator)try{yield navigator.serviceWorker.register("sw.js")}catch(t){console.error("Failed to register service worker: "+t)}}))}()}},886:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.cardCodes=new Set(["2","3","4","5","6","7","8","9","0","j","q","k","a"]),e.suitCodes=new Set(["c","d","s","h"])},257:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.names=["You","Left","North","3 o'Clock"]}},e={};!function s(i){if(e[i])return e[i].exports;var a=e[i]={exports:{}};return t[i].call(a.exports,a,a.exports,s),a.exports}(996)})();