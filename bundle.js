(()=>{"use strict";var t={19:function(t,s,e){var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(s,"__esModule",{value:!0});const a=i(e(477)),h=i(e(465)),n=i(e(196));class r{constructor(t,s){if(this.unknownCards=new a.default,this.playerSeenVoidInSuits=[],this.cardsIPassed=[],t.hasOwnProperty("whoAmI")){const s=t;this.unknownCards=new a.default(s.unknownCards),this.playerSeenVoidInSuits=s.playerSeenVoidInSuits,this.cardsIPassed.length=0,s.cardsIPassed.forEach((t=>{this.cardsIPassed.push(new n.default(t))})),this.gameHand=new h.default(s.gameHand),this.whoAmI=s.whoAmI}else this.gameHand=t,this.whoAmI=s,this.resetHand()}observeSelf(){this.gameHand.registerObserver(this)}setHand(t){this.gameHand=t}choosePassingCards(){performance.now();const t=this.gameHand.getHand(this.whoAmI),s=new Array(286).fill(0),e=new Array(286).fill([]);let i=0;for(let a=0;a<11;++a)for(let n=a+1;n<12;++n)for(let o=n+1;o<13;++o){const d=[t.at(a),t.at(n),t.at(o)];e[i]=d;for(let t=Math.floor(r.LEVEL/572)+1;t>0;--t){const t=new h.default(this.gameHand),e=[new r(t,0),new r(t,1),new r(t,2),new r(t,3)];t.setHands(this.speculateHands(t.getPassingDirection()));for(let s=0;s<4;++s)s===this.whoAmI?t.pass(s,(s+this.gameHand.getPassingDirection())%4,d):t.pass(s,(s+this.gameHand.getPassingDirection())%4,t.getHand(s).pickRandom(3));t.receivePassedCards();for(let s=13;s>0;--s){for(t.resetTrick();t.turnsLeftInTrick();)t.playCard(e[t.getWhoseTurn()].simPlayCard());t.endTrick()}t.endHand(),s[i]+=t.getScore(this.whoAmI)}++i}let a=0;for(i=0;i<286;++i)s[i]<s[a]&&(a=i);performance.now();return this.whoAmI,t.forEach((t=>{t.str()})),e[a],e[a]}speculateHands(t){const s=[new a.default,new a.default,new a.default,new a.default],e=[this.gameHand.getHand(0).length(),this.gameHand.getHand(1).length(),this.gameHand.getHand(2).length(),this.gameHand.getHand(3).length()];e[this.whoAmI]=0;const i=(this.whoAmI+t)%4;function h(t){return e[t]>0}e[i]-=this.cardsIPassed.length;const n=[];for(let t=0;t<4;++t)n.push([!this.playerSeenVoidInSuits[0][t]&&0!==this.whoAmI,!this.playerSeenVoidInSuits[1][t]&&1!==this.whoAmI,!this.playerSeenVoidInSuits[2][t]&&2!==this.whoAmI,!this.playerSeenVoidInSuits[3][t]&&3!==this.whoAmI]);const r=[];return this.unknownCards.forEach((t=>{if(r.length=0,n[t.suit].forEach(((t,s)=>{t&&h(s)&&r.push(s)})),r.length){const i=r[Math.floor(Math.random()*r.length)];s[i].insert(t),--e[i]}else{const i=[!1,!1,!1,!1];for(let t=0;t<4;++t)if(h(t))for(let s=0;s<4;++s)n[s][t]&&(i[s]=!0);const a=[],r=[];if(n[t.suit].forEach(((t,e)=>{t&&s[e].forEach((t=>{i[t.suit]&&(a.push(t),r.push(e))}))})),a.length){const i=Math.floor(Math.random()*a.length),o=[];n[a[i].suit].forEach(((t,s)=>{t&&h(s)&&o.push(s)})),0===o.length&&console.error("ERROR: assertion fail, single swap, no place to put swap card");const d=o[Math.floor(Math.random()*o.length)];s[d].insert(a[i]),s[r[i]].remove(a[i]),s[r[i]].insert(t),--e[d]}else{const r=n[t.suit].indexOf(!0);let o=0;for(let t=0;t<4;++t)if(h(t)){o=t;break}let d=0;for(;d===r||d===this.whoAmI||d===o;)++d;1!==n[t.suit].filter((t=>t)).length&&console.error("ERROR: big assertion was wrong, hands that allow this suit != 1");const l=[];s[d].forEach((t=>{i[t.suit]&&l.push(t)})),0===l.length&&console.error("ERROR: big assertion was wrong, no cards to move from 3rd to 2nd");const c=l[Math.floor(Math.random()*l.length)];s[o].insert(c),s[d].remove(c),--e[o],s[r].forEach((t=>{this.playerSeenVoidInSuits[d][t.suit]||a.push(t)})),0===a.length&&console.error("ERROR: big assertion was wrong, no cards to move from 1st to 3rd");const u=a[Math.floor(Math.random()*a.length)];s[d].insert(u),s[r].remove(u),s[r].insert(t)}}})),this.gameHand.getHand(this.whoAmI).forEach((t=>{s[this.whoAmI].insert(t)})),this.cardsIPassed.forEach((t=>{s[i].insert(t)})),s}resetHand(){this.unknownCards.fill(),this.cardsIPassed.length=0,this.playerSeenVoidInSuits=[[!1,!1,!1,!1],[!1,!1,!1,!1],[!1,!1,!1,!1],[!1,!1,!1,!1]]}dealHands(){this.whoAmI,this.gameHand.getHand(this.whoAmI).forEach((t=>{this.unknownCards.remove(t),t.str()}))}pass(t,s,e){t===this.whoAmI&&(this.cardsIPassed=e.slice())}receivePassedCards(){this.whoAmI,this.gameHand.getHand(this.whoAmI).forEach((t=>{this.unknownCards.remove(t),t.str()}))}resetTrick(){}seeCardPlayed(t,s,e=!1){this.unknownCards.remove(t);let i=-1;this.cardsIPassed.forEach(((s,e)=>{t.value===s.value&&t.suit===s.suit&&(i=e)})),-1!==i&&this.cardsIPassed.splice(i,1);const a=this.gameHand.getPlayedCards()[this.gameHand.getTrickLeader()].suit;t.suit!==a&&(this.playerSeenVoidInSuits[s][a]=!0),e&&(this.playerSeenVoidInSuits[s][n.default.CLUBS]=!0,this.playerSeenVoidInSuits[s][n.default.DIAMONDS]=!0,this.playerSeenVoidInSuits[s][n.default.SPADES]=!0)}staticPlayAI(){const t=this.gameHand.findValidChoices();if(this.gameHand.getPlayedCardCount()>0){const s=this.gameHand.getPlayedCards()[this.gameHand.getTrickLeader()];if(t[0].suit===s.suit){if(t[0].value<s.value){for(let e=t.length-1;e>=0;--e)if(t[e].value<s.value)return 13===t[e].value&&t[e].suit===n.default.SPADES&&e>0&&12===t[e-1].value?t[e-1]:t[e];return console.error("ERROR: should never get here"),t[0]}if(this.gameHand.getPlayedCardCount()<3)return s.suit===n.default.SPADES&&12===t[0].value&&t.length>1?t[1]:t[0];{const e=t[t.length-1];return s.suit===n.default.SPADES&&12===e.value&&t.length>1?t[t.length-2]:e}}{const s=[];for(let e=t.length-1;e>=0;--e)if(t[e].suit===n.default.SPADES){if(!(t[e].value>11))break;s.push(t[e])}if(s.length)return s[s.length-1];{let s=t[0].suit,e=s,i=t[0].value;for(let a=1;a<t.length;++a)t[a].suit!==s&&(s=t[a].suit,t[a].value>i&&(e=s,i=t[a].value));const a=this.gameHand.getHand(this.gameHand.getWhoseTurn()).getSuit(e);return a[a.length-1]}}}{const s=t.filter((t=>t.value<12||t.suit!==n.default.SPADES));return s.length?s[Math.floor(Math.random()*s.length)]:t[0]}}simPlayCard(){const t=this.gameHand.getHand(this.gameHand.getWhoseTurn()).length(),s=this.gameHand.getShootMoonPossible()?t>12?10:-.8*t+11.5:2;if(10*Math.random()<s){const t=this.gameHand.findValidChoices();return t[Math.floor(Math.random()*t.length)]}return this.staticPlayAI()}dynamicPlay(){const t=this.gameHand.findValidChoices();if(1===t.length)return t[0];const s=t.map((()=>0)),e=Math.floor(r.LEVEL/t.length/this.gameHand.getHand(this.gameHand.getWhoseTurn()).length())+1;for(let i=e;i>0;--i)t.forEach(((t,e)=>{const i=new h.default(this.gameHand),a=new r(i,this.whoAmI);i.setHands(this.speculateHands(i.getPassingDirection())),i.playCard(t);do{for(;i.turnsLeftInTrick();)i.playCard(a.simPlayCard());i.endTrick(),i.getHand(0).length()&&i.resetTrick()}while(i.getHand(0).length());i.endHand(),s[e]+=i.getScore(this.whoAmI)}));let i=0;t[0].str(),s[0];for(let e=1;e<t.length;++e)s[e]<s[i]&&(i=e),t[e].str(),s[e];return t[i]}}r.LEVEL=1e4,s.default=r},196:(t,s)=>{Object.defineProperty(s,"__esModule",{value:!0});class e{constructor(t,s){if(t.hasOwnProperty("suit")){const s=t;this.value=s.value,this.suit=s.suit}else this.value=t,this.suit=s}static find(t,s){let e=0,i=t.length,a=i>>1;for(;a<i;){if(t[a].value===s.value)return a;t[a].value>s.value?i=a:e=a+1,a=e+i>>1}return-1}str(){let t;switch(this.value){case 1:case 14:t="Ace of ";break;case 11:t="Jack of ";break;case 12:t="Queen of ";break;case 13:t="King of ";break;default:t=this.value.toString(),t+=" of "}switch(this.suit){case e.CLUBS:t+="Clubs";break;case e.DIAMONDS:t+="Diamonds";break;case e.SPADES:t+="Spades";break;case e.HEARTS:t+="Hearts";break;default:t+="UNKNOWN SUIT"}return t}hash(){return(this.value<<2)+this.suit}}e.CLUBS=0,e.DIAMONDS=1,e.SPADES=2,e.HEARTS=3,e.SUIT_COUNT=4,s.default=e},477:function(t,s,e){var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(s,"__esModule",{value:!0});const a=i(e(196));s.default=class{constructor(t){this.cards=[[],[],[],[]],t&&t.cards.forEach(((t,s)=>{t.forEach((t=>{this.cards[s].push(new a.default(t))}))}))}length(t=-1){return-1===t?this.cards[0].length+this.cards[1].length+this.cards[2].length+this.cards[3].length:this.cards[t].length}getSuitAndIndex(t){let s=0;for(;s<4&&t>=this.cards[s].length;)t-=this.cards[s].length,s+=1;return s<4?{suit:s,index:t}:null}at(t){const s=this.getSuitAndIndex(t);return s?this.cards[s.suit][s.index]:null}forEach(t){let s=0;this.cards.forEach((e=>{e.forEach((e=>{t(e,s),++s}))}))}find(t){let s=a.default.find(this.cards[t.suit],t);if(-1===s)return-1;for(let e=0;e<t.suit;++e)s+=this.cards[e].length;return s}remove(t){let s,e;if(t.hasOwnProperty("suit")){const i=t;if(e=this.cards[i.suit],s=a.default.find(e,i),-1===s)return}else{const i=this.getSuitAndIndex(t);if(!i)return;e=this.cards[i.suit],s=i.index}e.splice(s,1)}insert(t){const s=this.cards[t.suit];let e=0;for(;e<s.length&&!(s[e].value>t.value);++e);s.splice(e,0,t)}clear(){this.cards.forEach((t=>{t.length=0}))}fill(){this.cards.forEach(((t,s)=>{t.length=0;for(let e=2;e<15;++e)t.push(new a.default(e,s))}))}dealOne(){const t=Math.floor(Math.random()*this.length()),s=this.at(t);return this.remove(t),s}pickRandom(t){const s=[],e=[0,1,2,3,4,5,6,7,8,9,10,11,12];!function(t){for(let s=t.length-1;s>0;--s){const e=Math.floor(Math.random()*(s+1));[t[s],t[e]]=[t[e],t[s]]}}(e);for(let i=0;i<t;++i)s.push(this.at(e[i]));return s}getSuit(t){return this.cards[t]}slice(){return this.cards[0].concat(this.cards[1],this.cards[2],this.cards[3])}}},222:(t,s)=>{Object.defineProperty(s,"__esModule",{value:!0});s.default=class{constructor(t,s,e,i,a){this.x=t,this.y=s,this.w=e,this.h=i,this.onClick=a}contains(t,s){return t>=this.x&&s>=this.y&&t<this.x+this.w&&s<this.y+this.h}}},651:function(t,s,e){var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(s,"__esModule",{value:!0});const a=i(e(196)),h=i(e(222)),n=e(343),r=i(e(489));class o{constructor(){this.fromX=.4,this.fromY=-1,this.toX=this.fromX,this.toY=this.fromY,this.frame=0,this.endFrame=10}current(){if(0===this.endFrame)return[this.toX,this.toY];const t=this.toX-this.fromX,s=this.toY-this.fromY,e=this.frame/this.endFrame;return[e*t+this.fromX,e*s+this.fromY]}setLocation(t,s){this.fromX=t,this.fromY=s,this.toX=t,this.toY=s,this.frame=this.endFrame}setDestination(t,s){return(Math.abs(this.toX-t)>.0078125||Math.abs(this.toY-s)>.0078125)&&([this.fromX,this.fromY]=this.current(),this.toX=t,this.toY=s,this.endFrame=10,this.frame=0),this.current()}update(){this.frame+=this.frame<this.endFrame?1:0}}class d{constructor(t,s,e){this.cardWidth=42,this.cardHeight=58.5,this.vertical=!1,this.fontSize=18,this.context=t,this.assets=s,this.gui=e,this.menu=new r.default(t),this.cardAnimations=new Map;for(let t=2;t<15;++t)for(let s=0;s<a.default.SUIT_COUNT;++s)this.cardAnimations.set((t<<2)+s,new o);this.context.font=this.fontSize+"px Arial",this.context.textBaseline="top"}resize(t){this.vertical=this.context.canvas.height>this.context.canvas.width,this.cardWidth=t*this.context.canvas.width/(this.vertical?5.4:10.6),this.cardHeight=this.cardWidth*d.assetHeight/d.assetWidth,this.cardWidth,this.menu.resize()}setAiCards(){for(let t=1;t<4;++t){const[s,e]=d.playerPosition(t);this.gui.game.hand.getHand(t).forEach(((t,i)=>{var a;null===(a=this.cardAnimations.get(t.hash()))||void 0===a||a.setLocation(s,e)}))}}drawCard(t,s,e){const i=((14===t.value?1:t.value)-1)*d.valueXMult,a=d.suitAssetYs[t.suit],h=this.context.canvas,n=h.width,r=h.height,o=this.cardAnimations.get(t.hash());if(!o)throw"anim not found with card "+t.str();const[l,c]=o.setDestination(s/n,e/r);this.context.drawImage(this.assets,i,a,d.assetWidth,d.assetHeight,l*n,c*r,this.cardWidth,this.cardHeight),o.update()}static startsNewSuit(t,s){return 0===t||!(t>=s.length())&&s.at(t-1).suit!==s.at(t).suit}static getRowBreak(t){const s=t.length();let e=s>>1;if(d.startsNewSuit(e,t))return e;{let i=t.length(0)+t.length(1)>e?1:-1;e+=i;const a=s-8;for(;e>a&&e<8;){if(d.startsNewSuit(e,t))return e;e+=i}for(i=0-i,e=(s>>1)+i;e>a&&e<8;){if(d.startsNewSuit(e,t))return e;e+=i}return s>>1}}drawHand(t){const s=this.gui.game.hand.getHand(0),e=s.length(),i=[[],[]];let a=0;this.vertical&&e>7&&(a=d.getRowBreak(s));let n=0;s.forEach(((t,s)=>{s>=a&&(n=1),i[n].push({card:t,index:s})}));let r=this.context.canvas.height-2*(this.cardHeight+d.verticalPadding);const o=Math.max(i[0].length,i[1].length),l=o>Math.floor(this.context.canvas.width/(1.05*this.cardWidth))?(this.context.canvas.width-(this.cardWidth+10))/(o-1):1.05*this.cardWidth;i.forEach((s=>{const e=this.context.canvas.width/2-(l*(s.length-1)+this.cardWidth)/2;s.forEach(((s,i)=>{if(-1===this.gui.cardsToPass.find(s.card)){const a=e+l*i;this.drawCard(s.card,a,r),this.gui.clickables.push(new h.default(a,r,this.cardWidth,this.cardHeight,(()=>{t(s.card)})))}})),r+=this.cardHeight+d.verticalPadding}))}drawPlayerScore(t,s,e){this.context.fillText("Game: "+this.gui.game.scores[t],s,e),this.context.fillText("Hand: "+this.gui.game.hand.getScore(t),s,e+this.fontSize)}drawScores(){this.context.font=this.fontSize+"px Arial",this.context.textBaseline="top",this.context.fillStyle="#88ff88",this.context.fillText("Game: "+this.gui.game.scores[0]+"  Hand: "+this.gui.game.hand.getScore(0),5,this.yForBottomMiddle()+(this.cardHeight+d.verticalPadding)),this.drawPlayerScore(1,5,this.context.canvas.height/4),this.drawPlayerScore(2,(this.context.canvas.width+this.cardWidth+10)/2,5);const t=this.context.measureText("Game: 100").width;this.drawPlayerScore(3,this.context.canvas.width-(t+5),this.context.canvas.height/3)}yForBottomMiddle(){return this.context.canvas.height-((this.vertical?3:2)*(this.cardHeight+d.verticalPadding)+d.spaceAboveHand)}drawCardsToPass(){const t=this.yForBottomMiddle();let s=this.context.canvas.width/2-(1.5*this.cardWidth+10);this.gui.cardsToPass.forEach((e=>{this.drawCard(e,s,t),this.gui.clickables.push(new h.default(s,t,this.cardWidth,this.cardHeight,(()=>{this.gui.removeFromPass(e)}))),s+=this.cardWidth+10}))}drawPlayedCards(){const t=Math.min(this.yForBottomMiddle(),this.context.canvas.height/2),s=(this.context.canvas.width-this.cardWidth)/2,e=this.gui.game.hand.getPlayedCards();e[0].value&&this.drawCard(e[0],s,t),e[1].value&&this.drawCard(e[1],s-(10+this.cardWidth),t-(this.cardHeight/2+5)),e[2].value&&this.drawCard(e[2],s,t-(this.cardHeight+10)),e[3].value&&this.drawCard(e[3],s+(10+this.cardWidth),t-(this.cardHeight/2+5))}drawPreviousTrick(){if(4!==this.gui.game.hand.getPlayedCardCount()){const t=this.gui.game.hand.getPreviousTrick(),[s,e]=d.playerPosition(t.whoWon);for(let i of t.cards)this.drawCard(i,s*this.context.canvas.width,e*this.context.canvas.height)}}static playerPosition(t){return[t?t-1.6:.4,2===t?-.5:0===t?1.5:.2]}drawArrow(t,s,e,i,a){this.context.globalAlpha=a?1:.5,this.context.fillStyle=n.buttonColor,this.context.translate(t+e/2,s+e/2),this.context.rotate(i*Math.PI/2),this.context.beginPath(),this.context.moveTo(e/2,0),this.context.lineTo(0,0-e/2),this.context.lineTo(0,0-e/4),this.context.lineTo(0-e/2,0-e/4),this.context.lineTo(0-e/2,e/4),this.context.lineTo(0,e/4),this.context.lineTo(0,e/2),this.context.fill(),this.context.rotate(0-i*Math.PI/2),this.context.translate(0-(t+e/2),0-(s+e/2)),this.context.globalAlpha=1}drawPassButton(t){const s=this.context.canvas.width/2-40,e=this.context.canvas.height-((this.vertical?3:2)*(this.cardHeight+d.verticalPadding)+d.spaceAboveHand+d.verticalPadding+80);this.drawArrow(s,e,80,this.gui.game.getPassingDirection()+1,t),this.gui.clickables.push(new h.default(s,e,80,80,(()=>{this.gui.passButtonClick()})))}drawEnd(t){this.context.fillStyle=n.menuColor;const s=t.length+1,e=this.fontSize+2,i=["You","Left","North","3 o'Clock"],a=(s+2)*e,h=this.context.measureText(i[3]).width+2*e,r=(this.context.canvas.width-h)/2,o=(this.context.canvas.height-a)/2;this.context.fillRect(r,o,h,a),this.context.font=this.fontSize+"px Arial",this.context.textBaseline="top",this.context.fillStyle=n.menuTextColor,this.context.fillText("winner"+(t.length>1?"s:":":"),r+e,o+e),t.forEach(((t,s)=>{this.context.fillText(i[t],r+e,o+(s+2)*e)}))}background(){this.context.fillStyle="purple",this.context.fillRect(0,0,this.context.canvas.width,this.context.canvas.height)}drawMenu(){this.menu.draw(this.gui.clickables)}}d.suitAssetYs=[0,528,352,176],d.assetHeight=156,d.valueXMult=131.5834,d.assetWidth=112,d.verticalPadding=5,d.spaceAboveHand=20,s.default=d},421:function(t,s,e){var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(s,"__esModule",{value:!0});const a=i(e(465));class h{constructor(t){this.hand=new a.default,this.scores=[0,0,0,0],this.winners=[],this.passingIndex=0,t&&(this.hand=new a.default(t.hand),this.scores=t.scores,this.winners=t.winners,this.passingIndex=t.passingIndex)}reset(){this.winners.length=0,this.passingIndex=0,this.scores[0]=0,this.scores[1]=0,this.scores[2]=0,this.scores[3]=0}endHand(){let t=!1;for(let s=0;s<4;++s)this.scores[s]+=this.hand.getScore(s),this.scores[s]>99&&(t=!0);if(t){this.winners.push(0);for(let t=1;t<4;++t)this.scores[t]<this.scores[this.winners[0]]?(this.winners.length=0,this.winners.push(t)):this.scores[t]===this.scores[this.winners[0]]&&this.winners.push(t)}else this.changePassing()}changePassing(){this.passingIndex=(this.passingIndex+1)%4}getPassingDirection(){return h.passingDirections[this.passingIndex]}}h.passingDirections=[1,3,2,0],s.default=h},465:function(t,s,e){var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(s,"__esModule",{value:!0});const a=i(e(477)),h=i(e(196)),n=new h.default(0,0);s.default=class{constructor(t){if(this.hands=[new a.default,new a.default,new a.default,new a.default],this.scores=[0,0,0,0],this.passingDirection=0,this.passedCardsToPlayer=[[],[],[],[]],this.passCount=0,this.playedCards=[n,n,n,n],this.playedCardCount=0,this.trickLeader=0,this.whoseTurn=0,this.heartsBroken=!1,this.pointsPlayedThisTrick=!1,this.trickHistory=[],this.shootMoonPossible=!0,this.observerList=[],t){this.hands[0]=new a.default(t.hands[0]),this.hands[1]=new a.default(t.hands[1]),this.hands[2]=new a.default(t.hands[2]),this.hands[3]=new a.default(t.hands[3]),this.scores=t.scores.map((t=>t)),this.passingDirection=t.passingDirection;for(let s=0;s<4;++s)this.passedCardsToPlayer[s].length=0,t.passedCardsToPlayer[s].forEach((t=>{this.passedCardsToPlayer[s].push(new h.default(t))}));this.passCount=t.passCount,this.playedCards[0]=new h.default(t.playedCards[0]),this.playedCards[1]=new h.default(t.playedCards[1]),this.playedCards[2]=new h.default(t.playedCards[2]),this.playedCards[3]=new h.default(t.playedCards[3]),this.playedCardCount=t.playedCardCount,this.trickLeader=t.trickLeader,this.whoseTurn=t.whoseTurn,this.heartsBroken=t.heartsBroken,this.pointsPlayedThisTrick=t.pointsPlayedThisTrick,this.trickHistory=t.trickHistory.map((t=>({cards:t.cards.map((t=>new h.default(t))),whoWon:t.whoWon}))),this.shootMoonPossible=t.shootMoonPossible}}registerObserver(t){this.observerList.push(t)}getWhoseTurn(){return this.whoseTurn}getHand(t){return this.hands[t]}getScore(t){return this.scores[t]}getPassingDirection(){return this.passingDirection}turnsLeftInTrick(){return 4-this.playedCardCount}heartsIsBroken(){return this.heartsBroken}getPassCount(){return this.passCount}getPlayedCards(){return this.playedCards}getPlayedCardCount(){return this.playedCardCount}getPreviousTrick(){const t=this.trickHistory.length;return t?this.trickHistory[t-1]:{cards:[],whoWon:0}}getTrickLeader(){return this.trickLeader}getPassedCardsToPlayer(t){return this.passedCardsToPlayer[t]}getShootMoonPossible(){return this.shootMoonPossible}setPassed(){this.passCount=4}setHands(t){this.hands=t}resetHand(t){this.passingDirection=t;for(let t=0;t<4;++t)this.hands[t].clear(),this.scores[t]=0,this.passedCardsToPlayer[t].length=0;this.passCount=0,this.heartsBroken=!1,this.trickHistory.length=0,this.shootMoonPossible=!0,this.observerList.forEach((t=>{t.resetHand()}))}dealHands(){const t=new a.default;for(t.fill();t.length();)for(let s=0;s<4;++s){const e=t.dealOne();this.hands[s].insert(e),2===e.value&&e.suit===h.default.CLUBS&&(this.whoseTurn=s)}this.observerList.forEach((t=>{t.dealHands()}))}pass(t,s,e){e.forEach((e=>{this.passedCardsToPlayer[s].push(e),this.hands[t].remove(e)})),++this.passCount,this.observerList.forEach((i=>{i.pass(t,s,e)}))}receivePassedCards(){for(let t=0;t<4;++t)this.passedCardsToPlayer[t].forEach((s=>{this.hands[t].insert(s),2===s.value&&s.suit===h.default.CLUBS&&(this.whoseTurn=t)}));this.observerList.forEach((t=>{t.receivePassedCards()}))}resetTrick(){this.playedCards=[n,n,n,n],this.playedCardCount=0,this.trickLeader=this.whoseTurn,this.pointsPlayedThisTrick=!1,this.observerList.forEach((t=>{t.resetTrick()}))}takesLead(t){return t.suit===this.playedCards[this.trickLeader].suit&&t.value>this.playedCards[this.trickLeader].value}playCard(t){this.hands[this.whoseTurn].remove(t),this.playedCards[this.whoseTurn]=t,++this.playedCardCount,this.takesLead(t)&&(this.trickLeader=this.whoseTurn);let s=!1;t.suit===h.default.HEARTS&&(1!==this.playedCardCount||this.heartsBroken||(s=!0),this.heartsBroken=!0),this.pointsFor(t)&&(this.pointsPlayedThisTrick=!0);const e=this.whoseTurn;if(this.shootMoonPossible&&this.pointsPlayedThisTrick){let t=-1;for(let s=0;s<4;++s)if(this.getScore(s)){t=s;break}if(-1!==t){let s=!1,i=(e+5-this.getPlayedCardCount())%4;for(let e=this.getPlayedCardCount();e>0;--e){if(i===t){s=!0;break}i=(i+1)%4}s&&t!==this.getTrickLeader()&&(this.shootMoonPossible=!1)}}this.whoseTurn=(this.whoseTurn+1)%4,this.observerList.forEach((i=>{i.seeCardPlayed(t,e,s)}))}pointsFor(t){return t.suit===h.default.HEARTS?1:12===t.value&&t.suit===h.default.SPADES?13:0}endTrick(){this.playedCards.forEach((t=>{this.scores[this.trickLeader]+=this.pointsFor(t)})),this.whoseTurn=this.trickLeader,this.trickHistory.push({cards:this.playedCards.slice(),whoWon:this.trickLeader})}endHand(){this.playedCards=[n,n,n,n],this.playedCardCount=0;for(let t=0;t<4;++t){if(26===this.scores[t]){this.scores[t]=0;for(let s=0;s<4;++s)s!==t&&(this.scores[s]=26);return t}if(this.scores[t]>0)return-1}return alert("this should never happen, invalid scores"),-2}findValidChoices(){const t=this.hands[this.whoseTurn];if(13===t.length()){if(0===this.playedCardCount)return[new h.default(2,h.default.CLUBS)];if(t.length(h.default.CLUBS))return t.getSuit(h.default.CLUBS);{const s=[];return t.forEach((t=>{this.pointsFor(t)||s.push(t)})),s.length?s:t.slice()}}if(0===this.playedCardCount){if(this.heartsBroken)return t.slice();if(t.length(h.default.HEARTS)===t.length())return t.slice();const s=[];return t.forEach((t=>{t.suit!==h.default.HEARTS&&s.push(t)})),s}return t.length(this.playedCards[this.trickLeader].suit)?t.getSuit(this.playedCards[this.trickLeader].suit):t.slice()}}},402:function(t,s,e){var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(s,"__esModule",{value:!0});const a=i(e(196)),h=i(e(421)),n=i(e(19)),r=i(e(477)),o=i(e(12)),d=i(e(651)),l=i(e(313));class c{constructor(t,s,e){this.clickables=[],this.game=new h.default,this.ais=[],this.cardsToPass=new r.default,this.humanPlayerPassed=!1,this.receivedCards=[],this.showingPassedCards=!1,this.waiter=new o.default,this.storage=e,this.drawer=new d.default(t,s,this),this.stats=new l.default(e),this.worker=new Worker("workerbundle.js"),this.worker.addEventListener("message",(t=>{this.handleMessage(t.data)})),this.restore(),setInterval((()=>{this.draw()}),40)}resize(t){this.drawer.resize(t)}static filterOutObserverList(t,s){return"observerList"===t?void 0:s}workerMessagePassing(){const t=JSON.parse(JSON.stringify(this.ais,c.filterOutObserverList));this.worker.postMessage(t)}workerMessagePlay(){this.game.hand.getWhoseTurn();const t=JSON.parse(JSON.stringify(this.ais[this.game.hand.getWhoseTurn()],c.filterOutObserverList));this.worker.postMessage(t)}deleteSave(){this.storage.removeItem("game"),this.storage.removeItem("ais"),this.storage.removeItem("hpp")}save(){const t=JSON.stringify(this.game,c.filterOutObserverList),s=JSON.stringify(this.ais,c.filterOutObserverList);this.storage.setItem("game",t),this.storage.setItem("ais",s),this.storage.setItem("hpp",this.humanPlayerPassed?"t":"f")}restore(){const t=this.storage.getItem("game"),s=this.storage.getItem("ais"),e=this.storage.getItem("hpp");if(this.humanPlayerPassed="t"===e,t&&s){const e=JSON.parse(s);this.game=new h.default(JSON.parse(t)),this.ais=[null,new n.default(e[1]),new n.default(e[2]),new n.default(e[3])],this.ais[1].setHand(this.game.hand),this.ais[2].setHand(this.game.hand),this.ais[3].setHand(this.game.hand)}else this.game=new h.default,this.ais=[null,new n.default(this.game.hand,1),new n.default(this.game.hand,2),new n.default(this.game.hand,3)];for(let t=1;t<4;++t)this.game.hand.registerObserver(this.ais[t]);this.game.hand.registerObserver(this),t||(this.game.reset(),this.game.hand.resetHand(this.game.getPassingDirection())),this.drawer.setAiCards()}addToPass(t){t.str(),this.cardsToPass.length()<3&&(this.cardsToPass.insert(t),this.cardsToPass.length())}removeFromPass(t){t.str(),this.cardsToPass.remove(t)}playCard(t){t.str();this.game.hand.findValidChoices().some((s=>t.value===s.value&&t.suit===s.suit))&&this.game.hand.playCard(t)}passButtonClick(){if(!(this.cardsToPass.length()>2))return;this.humanPlayerPassed=!0;const t=this.cardsToPass.slice();this.cardsToPass.clear(),this.game.hand.pass(0,this.game.getPassingDirection(),t)}draw(){this.drawer.background(),this.clickables.length=0,this.drawer.drawScores(),this.humanPlayerPassed?this.game.hand.getPassCount()<4?this.drawer.drawHand((t=>{t.str()})):this.showingPassedCards?(this.cardsToPass.length(),this.drawer.drawHand((t=>{t.str()})),this.drawer.drawCardsToPass()):this.game.winners.length?(this.drawer.drawPreviousTrick(),this.drawer.drawEnd(this.game.winners)):(this.drawer.drawHand((t=>{this.playCard(t)})),this.drawer.drawPlayedCards(),this.drawer.drawPreviousTrick()):(this.drawer.drawHand((t=>{this.addToPass(t)})),this.drawer.drawCardsToPass(),this.drawer.drawPassButton(3===this.cardsToPass.length())),this.drawer.drawMenu()}click(t){if(t.x,t.y,!this.waiter.click())for(let s=this.clickables.length-1;s>=0;--s)if(this.clickables[s].contains(t.x,t.y)){this.clickables[s].onClick();break}}handleMessage(t){if(t.value)this.game.hand.getWhoseTurn(),this.waiter.gotMessage(new a.default(t));else for(let s=1;s<4;++s){const e=(s+this.game.getPassingDirection())%4,i=[new a.default(t[s][0]),new a.default(t[s][1]),new a.default(t[s][2])];this.game.hand.pass(s,e,i)}}drawWait(t,s,e){return this.waiter.wait(t,s,e)}showReceivedCards(){return this.showingPassedCards=!0,this.drawWait(3,!0,!1).then((()=>{this.showingPassedCards=!1,this.cardsToPass.clear()}))}computerTurn(){this.workerMessagePlay(),this.drawWait(.5,!0,!0).then((t=>{this.game.hand.playCard(t)}))}resetHand(){this.game.hand.dealHands()}dealHands(){this.receivedCards.length=0,this.game.getPassingDirection()?(this.humanPlayerPassed=!1,this.workerMessagePassing()):(this.game.hand.setPassed(),this.humanPlayerPassed=!0,this.drawer.setAiCards(),this.game.hand.resetTrick())}receivePassedCards(){this.drawer.setAiCards(),this.game.hand.resetTrick()}resetTrick(){0!==this.game.hand.getWhoseTurn()?this.computerTurn():this.save()}pass(t,s,e){0===t&&(this.humanPlayerPassed=!0),4===this.game.hand.getPassCount()?(this.receivedCards=this.game.hand.getPassedCardsToPlayer(0).slice(),this.cardsToPass.clear(),this.cardsToPass.insert(this.receivedCards[0]),this.cardsToPass.insert(this.receivedCards[1]),this.cardsToPass.insert(this.receivedCards[2]),this.showReceivedCards().then((()=>{this.game.hand.receivePassedCards()}))):3===this.game.hand.getPassCount()&&this.save()}seeCardPlayed(t,s,e){4===this.game.hand.getPlayedCardCount()?(this.game.hand.getPlayedCards().some((t=>12===t.value&&t.suit===a.default.SPADES))&&this.stats.queen(this.game.hand.getTrickLeader()),this.game.hand.endTrick(),this.drawWait(2,!0,!1).then((()=>{if(this.game.hand.getHand(0).length())this.game.hand.resetTrick();else{const t=this.game.hand.endHand();this.game.endHand(),this.stats.hand(t),this.game.winners.length?(this.stats.game(this.game.scores),this.deleteSave(),this.drawWait(2,!1,!1).then((()=>{this.drawWait(1e6,!0,!1).then((()=>{this.game.reset(),this.game.hand.resetHand(this.game.getPassingDirection())}))}))):this.drawWait(.5,!0,!1).then((()=>{this.game.hand.resetHand(this.game.getPassingDirection())}))}}))):0!==this.game.hand.getWhoseTurn()?this.computerTurn():this.save()}}s.default=c},489:function(t,s,e){var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(s,"__esModule",{value:!0});const a=i(e(222)),h=e(343);s.default=class{constructor(t){this.context=t,this.opened=!1,this.sizeX=0,this.sizeY=0,this.menuButtonLines=[0,1,2],this.fullX=128,this.fullY=128,this.resize()}randomizeMenuButtonLines(){let t=Math.trunc(3*Math.random());[this.menuButtonLines[0],this.menuButtonLines[t]]=[this.menuButtonLines[t],this.menuButtonLines[0]],t=Math.trunc(2*Math.random())+1,[this.menuButtonLines[1],this.menuButtonLines[t]]=[this.menuButtonLines[t],this.menuButtonLines[1]]}menuDrawCalculations(){const t=this.context.canvas.width,s=this.context.canvas.height,e=20*Math.sqrt(Math.PI);return{width:t,height:s,radius:20,buttonSize:e,buttonSizeD2:e/2,padding:5,x:t-5-20,y:25,quarter:Math.PI/2,donHeight:40,donWidth:70}}resize(){const{width:t,height:s,buttonSize:e,buttonSizeD2:i,x:h,y:n,donHeight:r,donWidth:o}=this.menuDrawCalculations();this.rc={fullscreenCloseMenu:new a.default(0,0,t,s,(()=>{this.opened=!1,this.sizeX===this.fullX&&this.randomizeMenuButtonLines()})),menuOpenBlank:new a.default(h-this.fullX-i,n-i,this.fullX+e,this.fullY+e,(()=>{})),openMenuButton:new a.default(h-e/2,n-e/2,e,e,(()=>{this.opened=!0,0===this.sizeX&&this.randomizeMenuButtonLines()})),closeMenuButton:new a.default(h-i,n-i,e,e,(()=>{this.opened=!1,this.sizeX===this.fullX&&this.randomizeMenuButtonLines()})),donButton:new a.default(h-o,n+this.fullY-r,o,r,(()=>{window.open("https://www.patreon.com/user?u=44765751","_blank")}))}}draw(t){const{radius:s,buttonSizeD2:e,padding:i,x:a,y:n,quarter:r,donHeight:o,donWidth:d}=this.menuDrawCalculations();this.opened?(this.sizeX=Math.min(this.fullX,this.sizeX+this.fullX/8),this.sizeY=Math.min(this.fullY,this.sizeY+this.fullY/8),t.push(this.rc.fullscreenCloseMenu)):(this.sizeX=Math.max(0,this.sizeX-this.fullX/8),this.sizeY=Math.max(0,this.sizeY-this.fullY/8)),this.context.fillStyle=h.menuColor,this.context.beginPath(),this.context.arc(a,n,s,r,0,!1),this.context.lineTo(a+s,n+this.sizeY),this.context.arc(a,n+this.sizeY,s,0,r,!1),this.context.lineTo(a-this.sizeX,n+this.sizeY+s),this.context.arc(a-this.sizeX,n+this.sizeY,s,3*r,Math.PI,!1),this.context.lineTo(a-this.sizeX-s,n),this.context.arc(a-this.sizeX,n,s,Math.PI,3*r,!1),this.context.lineTo(a,n-s),this.context.fill();const l=a-e+2*i,c=a+e-2*i,u=n-e+2*i,g=n+e-2*i,f=this.sizeY/this.fullY,m=[u,g,n];this.context.strokeStyle=h.menuTextColor;let w=m[this.menuButtonLines[0]],p=g,v=u,P=p-w,C=v-w;if(this.context.beginPath(),this.context.moveTo(c,w+f*C),this.context.lineTo(l,w+f*P),this.context.stroke(),w=m[this.menuButtonLines[1]],p=u,v=g,P=p-w,C=v-w,this.context.beginPath(),this.context.moveTo(c,w+f*C),this.context.lineTo(l,w+f*P),this.context.stroke(),this.context.globalAlpha=1-f,this.context.beginPath(),this.context.moveTo(c,m[this.menuButtonLines[2]]),this.context.lineTo(l,m[this.menuButtonLines[2]]),this.context.stroke(),this.context.globalAlpha=1,0===this.sizeX)t.push(this.rc.openMenuButton);else{const s=f*o,e=f*d;this.context.fillStyle=h.buttonColor,this.context.fillRect(a-e,n+this.sizeY-s,e,s),this.context.fillStyle=h.menuTextColor;Math.trunc(18*f)>5&&(this.context.font=Math.trunc(18*f)+"px Arial",this.context.textBaseline="top",this.context.fillText("Donate",a-.9*e,n+this.sizeY-.72*s)),this.sizeX===this.fullX&&(t.push(this.rc.menuOpenBlank),t.push(this.rc.closeMenuButton),t.push(this.rc.donButton))}}}},313:(t,s)=>{Object.defineProperty(s,"__esModule",{value:!0});class e{constructor(t){if(this.gameCount=0,this.handCount=0,this.placeCounts=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],this.scoreTotals=[0,0,0,0],this.bestScores=[999,999,999,999],this.worstScores=[0,0,0,0],this.moonCount=[0,0,0,0],this.queenCount=[0,0,0,0],t){const s=JSON.parse(t);this.gameCount=s.gameCount,this.handCount=s.handCount,this.placeCounts=s.placeCounts,this.scoreTotals=s.scoreTotals,this.bestScores=s.bestScores,this.worstScores=s.worstScores,this.moonCount=s.moonCount,this.queenCount=s.queenCount}}}s.default=class{constructor(t){this.data=new e,this.queenWho=-1,this.storage=t,this.init()}init(){const t=this.storage.getItem("statData");this.data=t?new e(t):new e}save(){this.storage.setItem("statData",JSON.stringify(this.data))}queen(t){this.queenWho=t}hand(t){++this.data.handCount,-1===this.queenWho?console.error("ERROR: Stats: hand called without queen"):++this.data.queenCount[this.queenWho],this.queenWho=-1,-1!==t&&++this.data.moonCount[t],this.save()}game(t){++this.data.gameCount;const s=t.slice().sort(((t,s)=>t-s));t.forEach(((t,e)=>{this.data.scoreTotals[e]+=t,t<this.data.bestScores[e]&&(this.data.bestScores[e]=t),t>this.data.worstScores[e]&&(this.data.worstScores[e]=t);const i=s.indexOf(t);++this.data.placeCounts[i][e]})),this.save()}}},12:(t,s)=>{Object.defineProperty(s,"__esModule",{value:!0});s.default=class{constructor(){this.waiting=!1,this.waitingTime=!1,this.clickSkips=!0,this.currentWait=null,this.needMessage=!1,this.haveMessage=!1,this.messageData=void 0,this.resolve=()=>{}}click(){return!(!this.waitingTime||!this.clickSkips)&&(clearTimeout(this.currentWait),this.waitingTime=!1,this.checkFinish(),!0)}wait(t,s,e){return this.waiting=!0,this.waitingTime=!0,this.clickSkips=s,this.needMessage=e,this.haveMessage=!1,this.needMessage,this.currentWait=setTimeout((()=>{this.waitingTime=!1,this.checkFinish()}),1e3*t),new Promise(((t,s)=>{this.resolve=t,this.checkFinish()}))}gotMessage(t){this.needMessage&&(this.haveMessage=!0,this.messageData=t,this.checkFinish())}checkFinish(){!this.waiting||this.waitingTime||this.needMessage&&!this.haveMessage||(this.waiting=!1,this.needMessage=!1,this.haveMessage=!1,this.resolve(this.messageData),this.messageData=void 0,this.resolve=()=>{})}}},343:(t,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.menuColor="lightgray",s.menuTextColor="black",s.buttonColor="orange"},996:function(t,s,e){var i=this&&this.__awaiter||function(t,s,e,i){return new(e||(e=Promise))((function(a,h){function n(t){try{o(i.next(t))}catch(t){h(t)}}function r(t){try{o(i.throw(t))}catch(t){h(t)}}function o(t){var s;t.done?a(t.value):(s=t.value,s instanceof e?s:new e((function(t){t(s)}))).then(n,r)}o((i=i.apply(t,s||[])).next())}))},a=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(s,"__esModule",{value:!0});const h=a(e(402));var n=document.getElementById("c"),r=document.getElementById("a"),o=window.localStorage;const d=new h.default(n.getContext("2d"),r,o);function l(){window.devicePixelRatio,n.width=window.innerWidth,n.height=Math.max(window.innerHeight,document.documentElement.clientHeight),d.resize(Math.min(window.devicePixelRatio,1)),d.draw()}window.addEventListener("resize",l,!1),n.addEventListener("click",(function(t){d.click(t)}),!1),window.onload=function(){l(),function(){i(this,void 0,void 0,(function*(){if("serviceWorker"in navigator)try{yield navigator.serviceWorker.register("sw.js")}catch(t){console.error("Failed to register service worker: "+t)}}))}()}}},s={};!function e(i){if(s[i])return s[i].exports;var a=s[i]={exports:{}};return t[i].call(a.exports,a,a.exports,e),a.exports}(996)})();